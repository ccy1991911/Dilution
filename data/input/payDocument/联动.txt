用户在商户APP选购商品
商户平台在联动优势平台下单
联动平台返回下单信息
商户APP调用SDK收银台发起支付请求
联动工具请求联动优势平台查询订单信息
联动优势平台返回联动工具支持的支付方式
联动工具展示给用户可供选择的支付方式
用户选择支付方式，支付银行，发起确认支付动作
联动优势平台返回联动工具支付要素
联动工具调起对应的支付方式
APP展示给用户对应的支付页面
用户发起确认支付动作完成支付
联动工具响应商户APP支付结果告知已收到操作结果
银行通知联动优势平台交易结果
商户app发起订单查询动作，通过商户后台调用联动查单接口获取订单状态
商户APP展示给用户操作结果


通知地址为下单请求中传递给平台的notify_url地址，商户需在下单接口中的notify_url字段中上送结果通知地址。如果商户不上送该字段，则平台无法通过后台通知商户支付结果。

平台对商户的支付请求数据处理完成后，会将处理的支付结果数据通过服务器主动通知的方式通知给商户网站。这些处理结果数据就是服务器异步通知参数。商户方在接收联动的支付结果通知时，请严格按如下要求接收交易结果通知。 

此解析方法内部已经做了对联动返回的数据验签处理，如果验签不过会抛出异常，商户无需再次对返回数据进行验签操作。
接口名称
参数字符编码集
签名方式
签名
响应数据格式
版本号
商户编号
服务器异步通知页面路径
商品号
商品描述信息
商户唯一订单号
原商户订单日期
付款币种
付款金额
商户私有域
用户IP地址
业务扩展信息
订单过期时长
商户用户标识
风控扩展信息
接口名称
参数字符编码集
签名方式
签名
版本号
商户编号
联动交易号
商品号
订单号
原商户订单日期
支付日期
付款金额
付款币种
支付方式
媒介标识
媒介类型
对账日期
商户私有域
订单状态
银行流水
交易错误码
支付协议号
商户用户标识
支付银行
银行卡卡号后四位
证件类型
证件号
持卡人姓名
微信用户id
接入指引：
1 拥有网站、APP应用、微信公众号账号商户
1.1 商户入网
登录平台，商户信息认证，银行账户验证
1.2 产品接入
产品分为聚合釜、订阅支付、企付通、实名认真、账户通
产品接入步骤基本分为产品签约、创建应用、开通产品、开发联调上线




H5收银台开发文档
1 文档说明
1.1 阅读对象
本文档的适用对象为接入支付平台的商户系统技术开发人员，日常维护人员以及日常对账人员。他们需要熟悉以下基本知识：
熟悉Mircosoft Windows 、UNIX和LINUX操作系统，熟悉这些操作系统上的网页制作以及基本的ASP和JSP的开发。了解一般的信息安全知识，比如HTTPS、非对称密钥机制、数字加密和数字签名等基本概念。
熟悉支付流程，了解其基本原理。

1.2接入步骤
 一、下载所需的联动联调工具包
下载所需的联调工具包，查看工具包中的readme文件，进行必要配置，运行代码示例查看效果。
 二、了解联动的开发规范（商户使用联动SDK不需要关注）
了解联动接口的签名机制以及验签机制：我司对应的产品接入规范中，对签名机制和验签都做了说明。以主扫为例，详见如下图：
 三、了解联动的订单处理规范与通知接规范（重要）
熟悉开发规范中的订单处理规范与通知接规范，同时对各个交易状态进行了解：为了避免出现对订单状态的理解歧义，建议您仔细阅读我司的订单处理规范以及异步结果通知规范。以主扫为例，详见如下图：
 四、了解联动对于商户联调完成的标准（上线前必看）
对于收款类产品以及付款类接口，建议商户务必对查单接口以及支付结果通知进行处理。其目的是为了在商户未收到异步结果通知的情况下，也可以调用查单接口获取订单状态。
1、关于交易结果通知的特别说明：在用户完成收付款交易后，我司会将订单最终结果通知给商户请求时的notifyUrl ，具体示例如下，商户需要对异步结果通知完成验签，并按我司要求给联动正确的响应数据。通知示例：
2、返回码的处理。为了减少商户与联动针对收付款订单的差异，我司针对不同产品，在指定的产品规范中对付款响应、收款响应、查单、退费等接口都做了逻辑处理说明并附带逻辑说明图。建议商户针对不同的接入产品时，阅读对应的产品规范。
商户正确响应示例：加粗内容是格式模板，商户不能修改。CONTENT内容为商户验签后给联动的响应数据。
注：使用联动SDK的商户无需对各个接口签名和验签进行处理,以及敏感字段加密，同时各接口提交参数对照文档API部分传递业务参数即可。


2 开发说明
2.1 名词解释
1.平台：如无特殊说明，均代表联动优势平台。
2.撤销：对已交易成功的订单进行回滚。（交易冲正）
3.退款：对已交易成功的操作进行退款处理，支持当日和隔日退款。
4.商户：与联动优势平台签约的使用支付业务平台服务器的、具有行业经营权的独立法人或机构。商户可为用户提供各种产品和服务。

2.2 接口规范
2.2.1 请求
1、商户提交给平台的请求可以以POST和GET的方式提交，当以GET方式请求时各参数的参数值需做URL编码，编码字符集UTF-8，当以POST方式请求时各参数的参数值不需要做URL编码。
2、签名的数据根据接口的定义，参见签名机制。
3、各请求参数的参数值的前后不允许出现空白符，否则将影响签名的正确性。
2.2.2 响应
响应的内容写在HTTP响应标签的CONTENT属性中，该内容中各数据项以字符“&”隔开。CONTENT必须大写，并且其内容中不能出现“<”和“>”的字符，每个数据项内不允许出现“&”符号。因为在HTML中可能有多个标签存在，此标签通过其NAME属性判断，其属性值为MobilePayPlatform，其格式如下：
签名的数据根据接口的定义，将需要签名的数据项以“key1=value1&key2=value2&key3=value3….”的格式做为签名对象进行签名，在签名对象末尾不能包含“&”符号。
各响应参数的参数值的前后不允许出现空白符，否则将影响签名的正确性。
2.2.3消息报文示例
请求消息（商户->平台）
个人充值请求（商户->平台）
此请求为页面跳转，所以无同步响应
通知消息（平台->商户）
前台通知见下。
后台通知见下。
通知消息的响应（商户->平台）
商户的通知，商户侧需要对通知消息进行如下响应

2.3 签名机制
2.3.1 请求
需要参与签名的参数：在请求参数列表中，除去sign、sign_type 两个参数外，其他需要使用到的参数皆是要签名的参数。在通知返回参数列表中，除去sign、sign_type两个参数外，凡是通知返回回来的参数皆是要签名的参数。
生成待签名字符串
对于如下的参数数组：
对数组里的每一个值从 a 到 z 的顺序排序，若遇到相同首字母，则看第二个字母，以此类推。(sign、sign_type不参与签名)
排序完成之后，再把所有数组值以“&”字符连接起来，如：
这串字符串便是待签名字符串。
注意：
(1)没有值的参数无需传递，如果传递需包含到待签名数据中；
(2)根据HTTP 协议要求，传递参数的值中如果存在特殊字符（如：&、@等），那么该值需要做URL Encoding，这样请求接收方才能接收到正确的参数值。这种情况下，待签名数据应该是原生值而不是encoding 之后的值。例如：调用某接口需要对请求参数media_Id进行数字签名，那么待签名数据应该是media_Id =test@msn.com，而不是media_Id =test%40msn.com。
2.3.2
RSA签名：在签名时，需要商户私钥参与签名；在签名前加密数据时，需要平台公钥进行加密。商户使用的私钥与公钥皆是平台内部生成一套对应文件，联动优势技术人员会在平台配置商户的公钥，并将商户的私钥及平台的公钥发送给商户方。因此，在签名时，商户要用到的是商户的私钥及平台的公钥。
请求时签名:当拿到请求时的待签名字符串后，把待签名字符串与客户的私钥一同放入RSA的签名函数中进行签名运算，从而得到签名结果字符串。当遇到需要加密的参数，需要先加密，后签名，再做url编码，此过程我方已封装入了接口，无需商户进行分解操作，商户方面需要保证数据在加密前能够正常。
通知返回时验证签名:当获得到通知返回时的待签名字符串后，把待签名字符串、平台提供的公钥、平台通知返回参数中的参数 sign 的值三者一同放入RSA 的签名函数中进行非对称的签名运算，来判断签名是否验证通过。



7 H5收银台支持银行列表
序号	银行简码	银行
1	BOC	中国银行
2	ABC	农业银行
3	ICBC	工商银行
4	CCB	建设银行
5	COMM	交通银行
6	PSBC	中国邮政储蓄银行
7	CMB	招商银行
8	CMBC	民生银行
9	CITIC	中信银行
10	CEB	光大银行
11	HXB	华夏银行
12	GDB	广发银行
13	CIB	兴业银行
14	SPDB	上海浦东发展银行
15	SPAB	平安银行
16	BEA	东亚银行
17	BHB	河北银行
18	BJB	北京银行
19	BOJZ	锦州银行
20	BOTJ	天津银行
21	BSB	包商银行
22	CDRCB	成都农村商业银行
23	CQB	重庆银行
24	CRCB	重庆农村商业银行
25	CSCB	长沙银行
26	CSRCB	常熟农村商业银行
27	CZCB	浙江稠州商业银行
28	CZSB	浙商银行
29	DAQINGB	龙江银行
30	DLB	大连银行
31	DYCCB	东营市商业银行
32	FJNXB	福建省农村信用社
33	GCB	广州银行
34	GRCB	广州农村商业银行
35	GYB	贵阳银行
36	HEBB	哈尔滨银行
37	HSB	徽商银行
38	HZCB	杭州银行
39	JJCCB	九江银行
40	JRCB	江阴农村商业银行
41	JSB	江苏银行
42	LZB	兰州银行
43	MTBANK	浙江民泰商业银行
44	NBB	宁波银行
45	NCB	南昌银行
46	NJCB	南京银行
47	ORBANK	鄂尔多斯银行
48	QDCCB	青岛银行
49	QHB	青海银行
50	QLBANK	齐鲁银行
51	SDEB	顺德农村商业银行
52	SHB	上海银行
53	SHRCB	上海农商银行
54	SRB	上饶银行
55	TZCB	台州银行
56	URMQCCB	乌鲁木齐市商业银行
57	WFCCB	潍坊银行
58	WHSHB	威海市商业银行
59	WJRCB	吴江农商行
60	WRCB	无锡农村商业银行
61	WZCB	温州银行
62	YDRCB	尧都农村商业银行
63	YZB	鄞州银行
64	ZJTLCB	浙江泰隆商业银行
65	CITIB  	花旗银行


8 借记卡支持的银行列表
序号	银行简码	银行
1.	CCB	建设银行
2.	ABC	农业银行
3.	BOC	中国银行
4.	CITIC	中信银行
5.	CEB	光大银行
6.	CIB	兴业银行
7.	SPDB	浦发银行
8.	ICBC	工商银行
9.	COMM	交通银行
10.	CZSB	浙商银行
11.	SPAB	平安银行
12.	CMB	招商银行
13.	CMBC	民生银行
14.	SHB	上海银行
15.	GDB	广发银行

快捷支付-支付
1.1下单  接口提交参数列表
支付流程包括三个接口，分别是1、下单获取交易号；2、短信验证码获取；3、确认支付。
下单成功后，联动给商户返还用户所选银行需要填写的支付要素等信息。

接口协议参数列表
注意：使用联动SDK不需要传送协议参数，SDK内部已经做好了封装，只需要上传业务参数即可
接口名称是apply_pay_shortcut
参数字符编码集是“商户网站使用的编码格式，支持UTF-8、GBK、GB2312、GB18030”
响应数据格式是暂只支持HTML
签名方式是暂只支持RSA必须大写
签名是参考文档开发说明->签名机制
版本号是暂定值4.0


下单  接口响应参数列表
接口响应协议参数列表
注意：使用联动SDK，SDK内部已经做了封装,只返回业务参数
签名方式是暂只支持RSA必须大写
签名是参考文档开发说明->签名机制
版本号是暂定值4.0

接口响应业务参数列表
商户编号是由平台统一分配合作商户唯一标识
商户订单号是与请求一致
商户订单日期是与请求一致YYYYMMDD
返回码是参考文档->返回码说明
返回信息是
联动交易号是联动生成的订单号
交易状态是参考交易状态说明
用户所需填写的支付要素是用户支付所需填写的支付要素（若为协议支付则判断是否有缺少的支付要素），此字段包含的所有标签都需要在下一个接口下发验证码中传递。


快捷支付-支付+签约
1.1下单  接口提交参数列表
支付流程同时可进行签约，签约后可以使用协议支付。本流程与5.1支付流程不同在于，下单时需同时传入mer_cust_id（商户用户标识）。支付成功后，联动平台会返回业务协议号和支务协议号，用于之后的协议支付。
下单时需同时传入mer_cust_id（商户用户标识），成功后，联动给商户返还用户所选银行需要填写的支付要素等信息。

接口协议参数列表
注意：使用联动SDK不需要传送协议参数，SDK内部已经做好了封装，只需要上传业务参数即可
名称是说明
接口名称是apply_pay_shortcut
参数字符编码集是“商户网站使用的编码格式，支持UTF-8、GBK、GB2312、GB18030”
响应数据格式是暂只支持HTML
签名方式是暂只支持RSA必须大写
签名是参考文档开发说明->签名机制
版本号是暂定值4.0

下单  接口响应参数列表
接口响应协议参数列表
注意：使用联动SDK，SDK内部已经做了封装,只返回业务参数
签名方式是暂只支持RSA必须大写
签名是参考文档开发说明->签名机制
版本号是暂定值4.0

接口响应业务参数列表
商户编号是由平台统一分配合作商户唯一标识
商户订单号是与请求一致
商户订单日期是与请求一致YYYYMMDD
返回码是参考文档->返回码说明
返回信息是
联动交易号是联动生成的订单号
交易状态是参考交易状态说明
用户所需填写的支付要素是用户支付所需填写的支付要素（若为协议支付则判断是否有缺少的支付要素），此字段包含的所有标签都需要在下一个接口下发验证码中传递。
注：字段“payElements”包含以下标签： valid_date, cvv2, card_id, card_holder, identity_type, identity_code 各标签之间用”,”分割，如：“valid_date,cvv2, card_id”，则用户下一步需填写信用卡有效期、信用卡cvv2及卡号号这三个支付要素。 各字段的含义如下：

1.3请求示例
SDK调用方法:
public Map quickPayOrderMap(Map RequestMap);//快捷支付下单
SDK调用示例


快捷支付-协议支付
1.1下单  接口提交参数列表
用户在“支付+签约”流程完成交易后，可以使用业务协议号和支付协议号进行协议支付。协议支付无需传入支付要素，验证短信验证码即可完成支付。
下单成功后，联动给商户返还用户所选银行需要填写的支付要素等信息。
注：协议支付时，可能由于支付通道的变化，需要让用户补充部分支付要素。

接口协议参数列表
注意：使用联动SDK不需要传送协议参数，SDK内部已经做好了封装，只需要上传业务参数即可
接口名称是apply_pay_shortcut
参数字符编码集是“商户网站使用的编码格式，支持UTF-8、GBK、GB2312、GB18030”
响应数据格式是暂只支持HTML
签名方式是暂只支持RSA必须大写
签名是参考文档开发说明->签名机制
版本号是暂定值4.0

下单  接口响应参数列表
接口响应协议参数列表
注意：使用联动SDK，SDK内部已经做了封装,只返回业务参数
签名方式是暂只支持RSA必须大写
签名是参考文档开发说明->签名机制
版本号是暂定值4.0

接口响应业务参数列表
业务参数列表
商户编号是由平台统一分配合作商户唯一标识
商户订单号是与请求一致
商户订单日期是与请求一致YYYYMMDD
返回码是参考文档->返回码说明
返回信息是
联动交易号是联动生成的订单号
交易状态是参考交易状态说明
用户所需填写的支付要素是用户支付所需填写的支付要素（若为协议支付则判断是否有缺少的支付要素），此字段包含的所有标签都需要在下一个接口下发验证码中传递。

注：字段“payElements”包含以下标签： valid_date, cvv2, card_id, card_holder, identity_type, identity_code 各标签之间用”,”分割，如：“valid_date,cvv2, card_id”，则用户下一步需填写信用卡有效期、信用卡cvv2及卡号号这三个支付要素。 各字段的含义如下
信用卡有效期
（YYMM）
信用卡CVN2/CVV2
卡号
持卡人姓名
证件类型
证件


快捷支付-解约接口
1.解约接口  接口提交参数列表
商户请求联动平台，解除用户在联动的关联关系，解除后，联动将不会再提供给用户协议支付服务。

接口协议参数列表
注意：使用联动SDK不需要传送协议参数，SDK内部已经做好了封装，只需要上传业务参数即可
接口名称是unbind_mercust_protocol_shortcut
签名方式是暂只支持RSA必须大写
参数字符编码集是“商户网站使用的编码格式，支持UTF-8、GBK、GB2312、GB18030”
签名是参考文档开发说明->签名机制
响应数据格式是暂只支持HTML
版本号是暂定值4.0


接口业务参数列表
商户编号是由平台统一分配合作商户唯一标识
支付方式是信用卡：CREDITCARD,借记卡:DEBITCARD

获取银行列表  接口响应参数列表
接口响应协议参数列表
注意：使用联动SDK，SDK内部已经做了封装,只返回业务参数
签名方式是暂只支持RSA必须大写
签名是参考文档开发说明->签名机制
版本号是暂定值4.0

接口响应业务参数列表
商户编号是由平台统一分配合作商户唯一标识
返回码是参考文档->返回码说明
返回信息是
商户银行列表信息是银行与银行之间用竖线“|”分割。如工商信用卡与建行信用卡表示如：ICBC|CCB



快捷支付支持银行列表
信用卡支持银行列表
BOC是中国银行
ABC是农业银行
ICBC是工商银行
CCB是建设银行
COMM是交通银行
PSBC是中国邮政储蓄银行
CMB是招商银行
CMBC是民生银行
CITIC是中信银行
CEB是光大银行
HXB是华夏银行
GDB是广发银行
CIB是兴业银行
SPDB是上海浦东发展银行
SPAB是平安银行
BEA是东亚银行
BHB是河北银行
BJB是北京银行
BOJZ是锦州银行
BOTJ是天津银行
BSB是包商银行
CDRCB是成都农村商业银行
CQB是重庆银行
CRCB是重庆农村商业银行
CSCB是长沙银行
CSRCB是常熟农村商业银行
CZCB是浙江稠州商业银行
CZSB是浙商银行
DAQINGB是龙江银行
DLB是大连银行
DYCCB是东营市商业银行
FJNXB是福建省农村信用社
GCB是广州银行
GRCB是广州农村商业银行
GYB是贵阳银行
HEBB是哈尔滨银行
HSB是徽商银行
HZCB是杭州银行
JJCCB是九江银行
JRCB是江阴农村商业银行
JSB是江苏银行
LZB是兰州银行
MTBANK是浙江民泰商业银行
NBB是宁波银行
NCB是南昌银行
NJCB是南京银行
ORBANK是鄂尔多斯银行
QDCCB是青岛银行
QHB是青海银行
QLBANK是齐鲁银行
SDEB是顺德农村商业银行
SHB是上海银行
SHRCB是上海农商银行
SRB是上饶银行
TZCB是台州银行
URMQCCB是乌鲁木齐市商业银行
WFCCB是潍坊银行
WHSHB是威海市商业银行
WJRCB是吴江农商行
WRCB是无锡农村商业银行
WZCB是温州银行
YDRCB是尧都农村商业银行
YZB是鄞州银行
ZJTLCB是浙江泰隆商业银行
CITIB是花旗银行

借记卡支持的银行列表
CCB是建设银行
ABC是农业银行
BOC是中国银行
CITIC是中信银行
CEB是光大银行
CIB是兴业银行
SPDB是浦发银行
ICBC是工商银行
COMM是交通银行
CZSB是浙商银行
SPAB是平安银行
CMB是招商银行
CMBC是民生银行
SHB是上海银行
GDB是广发银行

快捷支付常见问题列表
 标准支付的订单有效期是多长时间？
目前联动订单的默认有效时间为24个小时，从商户下单开始计算，超过有效期的订单状态无法变更为交易成功，如订单已经过期支付成功的单将会被冲正。 商户可以在下单时通过expire_time字段来定义有效期，单位为分钟，时间为24小时内。
 调用支付接口时为何报 “00200076：商户未开通产品关系”？
商户当前调用的支付产品未开通，请确认调用接口是否正确。
 下发的短信验证码内容是否支持定制？
暂不支持。
 快捷支付是否必须下发验证码？
使用快捷支付必须下发验证码进行持有性验证。
 商户调用协议支付接口或者调用解约接口报“业务协议依赖的支付协议关系不存在”？
当前用户的银行卡未签约（绑卡）或者已经解约（解绑），请商户确认。商户可调用签约查询接口（query_mercust_bank_shortcut）查询用户签约绑卡情况，或者联系客服或者运营查询。
 用户支付成功，商户为何未上账？
商户可以通过查询接口来查补交易状态。造成商户未上账的原因通常有：
1、银行侧通知延迟；
2、银行侧调单，需要等第二个工作日联动和银行对账查是否有差异信息，如有差异则会原路退回给持卡人，通常时间需要3-5个工作日；
3、商户仅依赖交易结果通知，该笔交易因某种原因未送达或者送达商户端处理失败，商户需使用查单接口进行完善。
 调试收款接口时报 "00131040 - 无可用支付通道，未找到支持当前发卡行、卡类型的可用支付通道,或通道参数配置不完整"？
不支持该发卡行进行交易。
 调用首次支付接口成功后为何没有绑卡成功？
首次支付时需上传商户用户标识（mer_cust_id)请参考规范说明。
 ret_code=00080732&ret_msg=不支持该类卡交易，请更换银行卡？
商户传递的卡号系统无法识别，请和用户确认银行卡的卡片信息。
 已经发起支付使用查询接口报“订单不存在”？
订单查询时，商户需确保 mer_id , mer_date , order_id 与原订单相同，依然订单不存在的，说明该笔请求未受理成功。
 商户退款是否支持当日退（T+0）？
商户默认不支持当日操作退款，当日需要退费的可以申请撤销，撤销仅支持全部撤销。
 累计退款金额大于支付金额？（ret_code=00060774&ret_msg=累计退款金额大于支付金额）
说明该笔订单累计受理的退费金额已经超过原订单支付金额，请商户核实。
 退款请求返回哪些状态可以确认退款成功？
退费“REFUND_PROCESS”状态，说明该笔退费已经成功受理，“REFUND_SUCCESS”说明已受理退费已经退费成功。
 交易撤销时是否支持部分撤销？
撤销操作仅支持全部撤销。
 撤销交易以后会多久到账？发起退费后多久会到账？
依据银行通道的不同，撤销和退费通常3-7个工作日会到账。
 退款受理时间段？
不支持时间段23:45至00:25的退款请求。
 为何会返回申请退费失败？
退款在0点日切时有限制， 23点45分到0点25分内，商户无法进行退款操作。 待结算账户中的金额（当日交易额），需大于退款金额20%，即如需退款1元，当日交易额需大于1.2元。
 每天对账生成的时间？何时下载对账文件？对账文件是所有的交易类型在一个对账文件里 还是多个文件？对账文件当中是不是会出现自然日跨日的交易？？
联动对账任务是在凌晨开始执行，通常T+1日9点可以下载对账文件。收款交易（网银、快捷、微信、支付宝）在同一个对账文件中。付款交易、鉴权交易的对账文件是分别独立的。


